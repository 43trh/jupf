/*! For license information please see 817.beb201204c0d29bdb240.js.LICENSE.txt */
(()=>{var t={817:(t,e,s)=>{var r;r=function(){return(()=>{"use strict";var t={"./node_modules/@jupyterlite/contents/lib/drivefs.js":function(t,e,s){s.r(e),s.d(e,{BLOCK_SIZE:function(){return o},ContentsAPI:function(){return d},DRIVE_API_PATH:function(){return i},DRIVE_SEPARATOR:function(){return n},DriveFS:function(){return m},DriveFSEmscriptenNodeOps:function(){return h},DriveFSEmscriptenStreamOps:function(){return l},ServiceWorkerContentsAPI:function(){return f}});var r=s("./node_modules/@jupyterlite/contents/lib/emscripten.js");const n=":",i="/api/drive.v1",o=4096,a=new TextEncoder,c=new TextDecoder("utf-8"),u={0:!1,1:!0,2:!0,64:!0,65:!0,66:!0,129:!0,193:!0,514:!0,577:!0,578:!0,705:!0,706:!0,1024:!0,1025:!0,1026:!0,1089:!0,1090:!0,1153:!0,1154:!0,1217:!0,1218:!0,4096:!0,4098:!0};class l{constructor(t){this.fs=t}open(t){const e=this.fs.realPath(t.node);this.fs.FS.isFile(t.node.mode)&&(t.file=this.fs.API.get(e))}close(t){if(!this.fs.FS.isFile(t.node.mode)||!t.file)return;const e=this.fs.realPath(t.node),s=t.flags;let r="string"==typeof s?parseInt(s,10):s;r&=8191;let n=!0;r in u&&(n=u[r]),n&&this.fs.API.put(e,t.file),t.file=void 0}read(t,e,s,r,n){if(r<=0||void 0===t.file||n>=(t.file.data.length||0))return 0;const i=Math.min(t.file.data.length-n,r);return e.set(t.file.data.subarray(n,n+i),s),i}write(t,e,s,r,n){var i;if(r<=0||void 0===t.file)return 0;if(t.node.timestamp=Date.now(),n+r>((null===(i=t.file)||void 0===i?void 0:i.data.length)||0)){const e=t.file.data?t.file.data:new Uint8Array;t.file.data=new Uint8Array(n+r),t.file.data.set(e)}return t.file.data.set(e.subarray(s,s+r),n),r}llseek(t,e,s){let n=e;if(s===r.SEEK_CUR)n+=t.position;else if(s===r.SEEK_END&&this.fs.FS.isFile(t.node.mode)){if(void 0===t.file)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM);n+=t.file.data.length}if(n<0)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EINVAL);return n}}class h{constructor(t){this.fs=t}node(t){return(0,r.instanceOfStream)(t)?t.node:t}getattr(t){const e=this.node(t);return{...this.fs.API.getattr(this.fs.realPath(e)),mode:e.mode,ino:e.id}}setattr(t,e){const s=this.node(t);for(const[t,r]of Object.entries(e))switch(t){case"mode":s.mode=r;break;case"timestamp":s.timestamp=r;break;default:console.warn("setattr",t,"of",r,"on",s,"not yet implemented")}}lookup(t,e){const s=this.node(t),r=this.fs.PATH.join2(this.fs.realPath(s),e),n=this.fs.API.lookup(r);if(!n.ok)throw this.fs.FS.genericErrors[this.fs.ERRNO_CODES.ENOENT];return this.fs.createNode(s,e,n.mode,0)}mknod(t,e,s,r){const n=this.node(t),i=this.fs.PATH.join2(this.fs.realPath(n),e);return this.fs.API.mknod(i,s),this.fs.createNode(n,e,s,r)}rename(t,e,s){const r=this.node(t),n=this.node(e);this.fs.API.rename(r.parent?this.fs.PATH.join2(this.fs.realPath(r.parent),r.name):r.name,this.fs.PATH.join2(this.fs.realPath(n),s)),r.name=s,r.parent=n}unlink(t,e){this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(t)),e))}rmdir(t,e){this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(t)),e))}readdir(t){return this.fs.API.readdir(this.fs.realPath(this.node(t)))}symlink(t,e,s){throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM)}readlink(t){throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM)}}class d{constructor(t,e,s,r){this._driveName=t,this._mountpoint=e,this.FS=s,this.ERRNO_CODES=r}lookup(t){return this.request({method:"lookup",path:this.normalizePath(t)})}getmode(t){return this.request({method:"getmode",path:this.normalizePath(t)})}mknod(t,e){return this.request({method:"mknod",path:this.normalizePath(t),data:{mode:e}})}rename(t,e){return this.request({method:"rename",path:this.normalizePath(t),data:{newPath:this.normalizePath(e)}})}readdir(t){const e=this.request({method:"readdir",path:this.normalizePath(t)});return e.push("."),e.push(".."),e}rmdir(t){return this.request({method:"rmdir",path:this.normalizePath(t)})}get(t){const e=this.request({method:"get",path:this.normalizePath(t)});if(!e)throw new this.FS.ErrnoError(this.ERRNO_CODES.ENOENT);const s=e.content,r=e.format;switch(r){case"json":case"text":return{data:a.encode(s),format:r};case"base64":{const t=atob(s),e=t.length,n=new Uint8Array(e);for(let s=0;s<e;s++)n[s]=t.charCodeAt(s);return{data:n,format:r}}default:throw new this.FS.ErrnoError(this.ERRNO_CODES.ENOENT)}}put(t,e){switch(e.format){case"json":case"text":return this.request({method:"put",path:this.normalizePath(t),data:{format:e.format,data:c.decode(e.data)}});case"base64":{let s="";for(let t=0;t<e.data.byteLength;t++)s+=String.fromCharCode(e.data[t]);return this.request({method:"put",path:this.normalizePath(t),data:{format:e.format,data:btoa(s)}})}}}getattr(t){const e=this.request({method:"getattr",path:this.normalizePath(t)});return e.atime&&(e.atime=new Date(e.atime)),e.mtime&&(e.mtime=new Date(e.mtime)),e.ctime&&(e.ctime=new Date(e.ctime)),e.size=e.size||0,e}normalizePath(t){return t.startsWith(this._mountpoint)&&(t=t.slice(this._mountpoint.length)),this._driveName&&(t=`${this._driveName}${n}${t}`),t}}class f extends d{constructor(t,e,s,r,n){super(e,s,r,n),this._baseUrl=t}request(t){const e=new XMLHttpRequest;e.open("POST",encodeURI(this.endpoint),!1);try{e.send(JSON.stringify(t))}catch(t){console.error(t)}if(e.status>=400)throw new this.FS.ErrnoError(this.ERRNO_CODES.EINVAL);return JSON.parse(e.responseText)}get endpoint(){return`${this._baseUrl}api/drive`}}class m{constructor(t){this.FS=t.FS,this.PATH=t.PATH,this.ERRNO_CODES=t.ERRNO_CODES,this.API=this.createAPI(t),this.driveName=t.driveName,this.node_ops=new h(this),this.stream_ops=new l(this)}createAPI(t){return new f(t.baseUrl,t.driveName,t.mountpoint,t.FS,t.ERRNO_CODES)}mount(t){return this.createNode(null,t.mountpoint,511|r.DIR_MODE,0)}createNode(t,e,s,r){const n=this.FS;if(!n.isDir(s)&&!n.isFile(s))throw new n.ErrnoError(this.ERRNO_CODES.EINVAL);const i=n.createNode(t,e,s,r);return i.node_ops=this.node_ops,i.stream_ops=this.stream_ops,i}getMode(t){return this.API.getmode(t)}realPath(t){const e=[];let s=t;for(e.push(s.name);s.parent!==s;)s=s.parent,e.push(s.name);return e.reverse(),this.PATH.join.apply(null,e)}}},"./node_modules/@jupyterlite/contents/lib/emscripten.js":function(t,e,s){s.r(e),s.d(e,{DIR_MODE:function(){return r},FILE_MODE:function(){return n},SEEK_CUR:function(){return i},SEEK_END:function(){return o},instanceOfStream:function(){return a}});const r=16895,n=33206,i=1,o=2;function a(t){return"node"in t}},"./src/aliases.ts":function(t,e,s){s.r(e),s.d(e,{Aliases:function(){return r}});class r extends Map{constructor(){super(),this.set("dir","dir --color=auto"),this.set("grep","grep --color=auto"),this.set("ls","ls --color=auto"),this.set("ll","ls -lF"),this.set("vdir","vdir --color=auto")}getRecursive(t){let e=this.get(t);for(;void 0!==e;){const s=e.split(" ")[0];if(s===t)break;const r=this.get(s);e=void 0===r?r:r+e.slice(s.length),t=s}return e}match(t){return[...this.keys()].filter((e=>e.startsWith(t)))}}},"./src/ansi.ts":function(t,e,s){s.r(e),s.d(e,{ansi:function(){return n}});const r="[",n={cursorUp:(t=1)=>t>0?r+t+"A":"",cursorDown:(t=1)=>t>0?r+t+"B":"",cursorRight:(t=1)=>t>0?r+t+"C":"",cursorLeft:(t=1)=>t>0?r+t+"D":"",cursorHome:"[H",eraseScreen:"[2J",eraseSavedLines:"[3J",eraseEndLine:"[K",eraseStartLine:"[1K",styleReset:"[1;0m",styleBoldRed:"[1;31m",styleBoldGreen:"[1;32m",styleBrightRed:"[0;91m",styleBrightGreen:"[0;92m",styleBrightYellow:"[0;93m",styleBrightBlue:"[0;94m",styleBrightPurple:"[0;95m",styleBrightCyan:"[0;96m",styleRed:"[0;31m",styleGreen:"[0;32m",styleYellow:"[0;33m",styleBlue:"[0;34m",stylePurple:"[0;35m",styleCyan:"[0;36m"}},"./src/buffered_io.ts":function(t,e,s){s.r(e),s.d(e,{MainBufferedIO:function(){return i},WorkerBufferedIO:function(){return o}});var r=s("./src/termios.ts");class n{constructor(t){const e=Int32Array.BYTES_PER_ELEMENT,s=this._maxReadChars+3,r=this._maxWriteChars+2,n=s+r;this._sharedArrayBuffer=void 0===t?new SharedArrayBuffer(n*e):t,this._readArray=new Int32Array(this._sharedArrayBuffer,0,s),void 0===t&&(this._readArray[0]=0,this._readArray[1]=0),this._writeArray=new Int32Array(this._sharedArrayBuffer,s*e,r),void 0!==t&&(this._writeArray[0]=0,this._writeArray[1]=0)}async disable(){this._enabled=!1,this._clear()}async enable(){this._enabled=!0}get enabled(){return this._enabled}utf8ArrayToString(t){return void 0===this._utf8Decoder&&(this._utf8Decoder=new TextDecoder("utf8")),this._utf8Decoder.decode(t)}_clear(){this._readArray[0]=0,this._readArray[1]=0,this._readCount=0}_loadFromSharedArrayBuffer(){const t=Atomics.load(this._readArray,2),e=[];for(let s=0;s<t;s++)e.push(Atomics.load(this._readArray,3+s));return e}_enabled=!1;_sharedArrayBuffer;_maxReadChars=64;_readArray;_readCount=0;_maxWriteChars=256;_writeArray;_utf8Decoder}class i extends n{outputCallback;constructor(t){super(),this.outputCallback=t}async disable(){if(this._disabling=!0,this._readSentCount!==this._readCount){const t=this._loadFromSharedArrayBuffer();let e="";for(const s of t)e+=String.fromCharCode(s);await this._sendStdinNow(e)}for(;this._readBuffer.length>0;)await this._sendStdinNow(this._readBuffer.shift());this._disabling=!1,super.disable()}dispose(){this._isDisposed||(this._disposing=!0,Atomics.store(this._writeArray,0,999),Atomics.notify(this._writeArray,0),this._isDisposed=!0)}get sharedArrayBuffer(){return this._sharedArrayBuffer}async push(t){this._readBuffer.push(t),this._readBufferCount++,t.length>this._maxReadChars&&console.log(`String '${t}' is too long to buffer`),this._disabling||this._readCount!==this._readSentCount||this._storeInSharedArrayBuffer()}registerSendStdinNow(t){this._sendStdinNow=t}async start(){this._listenForWrite()}async _afterListenWrite(){let t="",e=!0;do{let s=Atomics.load(this._writeArray,1);e=0===s,e&&(s=this._maxWriteChars);const r=new Int16Array(s);for(let t=0;t<s;t++)r[t]=Atomics.load(this._writeArray,2+t);t+=String.fromCharCode(...r),!e&&t.length>0&&!this._disposing&&this.outputCallback(t),Atomics.store(this._writeArray,0,0),Atomics.notify(this._writeArray,0,1),e&&!this._disposing&&await Atomics.waitAsync(this._writeArray,0,0).value}while(e);this._disposing||this._listenForWrite()}_afterRead(){if(this._readCount=Atomics.load(this._readArray,1),this._readCount!==this._readSentCount)throw new Error("Should not happen");this._readBufferCount>this._readSentCount&&this._storeInSharedArrayBuffer()}_clear(){super._clear(),this._readBuffer=[],this._readBufferCount=0,this._readSentCount=0}_listenForWrite(){const{async:t,value:e}=Atomics.waitAsync(this._writeArray,0,0);t&&e.then((()=>{this._disabling||this._afterListenWrite()}))}_storeInSharedArrayBuffer(){const t=this._readBuffer.shift();this._readSentCount++;const e=t.length;Atomics.store(this._readArray,2,e);for(let s=0;s<e;s++)Atomics.store(this._readArray,3+s,t.charCodeAt(s));Atomics.store(this._readArray,0,this._readSentCount),Atomics.notify(this._readArray,0,1);const{async:s,value:r}=Atomics.waitAsync(this._readArray,1,this._readCount);s&&r.then((()=>this._afterRead()))}_disposing=!1;_isDisposed=!1;_disabling=!1;_readBuffer=[];_readBufferCount=0;_readSentCount=0;_sendStdinNow}class o extends n{constructor(t){super(t)}allowAdjacentNewline(t){this._allowAdjacentNewline=t}poll(t){const e=t>0?t:0;return 4|("not-equal"===Atomics.wait(this._readArray,0,this._readCount,e)?1:0)}read(){if((this.termios.c_iflag&r.InputFlag.IXON)>0&&Atomics.wait(this._readArray,0,this._readCount),Atomics.load(this._readArray,0)===this._readCount)return[];const t=this._loadFromSharedArrayBuffer();this._readCount++,Atomics.store(this._readArray,1,this._readCount),Atomics.notify(this._readArray,1,1);const e=this._processReadChars(t);return this._maybeEchoToOutput(e),e}get termios(){return this._termios}write(t){let e=[];e="string"==typeof t?this._processWriteChars(t.split("").map((t=>t.charCodeAt(0)))):this._processWriteChars(t);let s=e.length,r=0;for(;s>0;){const t=s>this._maxWriteChars;Atomics.store(this._writeArray,0,1),Atomics.store(this._writeArray,1,t?0:s);const n=t?this._maxWriteChars:s;for(let t=0;t<n;t++)Atomics.store(this._writeArray,2+t,e[r+t]);Atomics.notify(this._writeArray,0,1),Atomics.wait(this._writeArray,0,1),s-=this._maxWriteChars,r+=this._maxWriteChars}}_maybeEchoToOutput(t){const e=(this.termios.c_lflag&r.LocalFlag.ECHO)>0,s=(this.termios.c_lflag&r.LocalFlag.ECHONL)>0;if(!e&&!s)return;const n=[];for(const s of t)switch(s){case 10:n.push(10);break;case 4:break;default:e&&n.push(s)}n.length>0&&this.write(n)}_processReadChars(t){const e=[];for(const s of t)switch(s){case 13:this.termios.c_iflag&r.InputFlag.IGNCR||((this.termios.c_iflag&r.InputFlag.ICRNL)>0?e.push(10):e.push(13));break;case 10:(this.termios.c_iflag&r.InputFlag.INLCR)>0?e.push(13):e.push(10);break;default:e.push(s)}return e}_processWriteChars(t){let e=!1,s=0;const n=[];for(let i=0;i<t.length;i++){const o=t[i];switch(e||27!==o||(e=!0,s=i),o){case 10:if(0===this._writeColumn&&!this._allowAdjacentNewline)break;this._writeColumn=0,(this.termios.c_oflag&r.OutputFlag.ONLCR)>0?n.push(13,10):n.push(10);break;default:e||this._writeColumn++,n.push(o)}e&&i>s+2&&(o>=65&&o<=90||o>=97&&o<=122)&&(e=!1)}return n}_termios=r.Termios.newDefaultWasm();_allowAdjacentNewline=!1;_writeColumn=0}},"./src/builtin/alias_command.ts":function(t,e,s){s.r(e),s.d(e,{AliasCommand:function(){return c}});var r=s("./src/builtin/builtin_command.ts"),n=s("./src/builtin/option.ts"),i=s("./src/builtin/options.ts"),o=s("./src/exit_code.ts");class a extends i.Options{trailingStrings=new n.TrailingStringsOption(0)}class c extends r.BuiltinCommand{get name(){return"alias"}async _run(t){const{aliases:e,args:s,stdout:r}=t,n=i.Options.fromArgs(s,a);if(n.trailingStrings.isSet)for(const t of n.trailingStrings.strings){const s=t.indexOf("=");-1===s?r.write(`${t}='${e.get(t)}'\n`):e.set(t.slice(0,s),t.slice(s+1))}else for(const[t,s]of e.entries())r.write(`${t}='${s}'\n`);return o.ExitCode.SUCCESS}}},"./src/builtin/builtin_command.ts":function(t,e,s){s.r(e),s.d(e,{BuiltinCommand:function(){return n}});var r=s("./src/error_exit_code.ts");class n{names(){return[this.name]}run(t,e){if(t!==this.name)throw new r.FindCommandError(t);return this._run(e)}}},"./src/builtin/cd_command.ts":function(t,e,s){s.r(e),s.d(e,{CdCommand:function(){return u}});var r=s("./src/builtin/builtin_command.ts"),n=s("./src/builtin/option.ts"),i=s("./src/builtin/options.ts"),o=s("./src/error_exit_code.ts"),a=s("./src/exit_code.ts");class c extends i.Options{trailingStrings=new n.TrailingStringsOption(0)}class u extends r.BuiltinCommand{get name(){return"cd"}async _run(t){const{args:e}=t,s=i.Options.fromArgs(e,c).trailingStrings.strings;if(s.length<1)return a.ExitCode.SUCCESS;if(s.length>1)throw new o.GeneralError("cd: too many arguments");let r=s[0];if("-"===r){const e=t.environment.get("OLDPWD");if(void 0===e)throw new o.GeneralError("cd: OLDPWD not set");r=e,t.stdout.write(`${r}\n`)}const{FS:n}=t.fileSystem,u=n.cwd();return n.chdir(r),t.environment.set("OLDPWD",u),t.environment.set("PWD",n.cwd()),a.ExitCode.SUCCESS}}},"./src/builtin/clear_command.ts":function(t,e,s){s.r(e),s.d(e,{ClearCommand:function(){return o}});var r=s("./src/builtin/builtin_command.ts"),n=s("./src/ansi.ts"),i=s("./src/exit_code.ts");class o extends r.BuiltinCommand{get name(){return"clear"}async _run(t){const{stdout:e}=t;return e.supportsAnsiEscapes()&&e.write(n.ansi.eraseScreen+n.ansi.eraseSavedLines+n.ansi.cursorHome),i.ExitCode.SUCCESS}}},"./src/builtin/cockle_config_command.ts":function(t,e,s){s.r(e),s.d(e,{CockleConfigCommand:function(){return c}});var r=s("./src/builtin/builtin_command.ts"),n=s("./src/ansi.ts"),i=s("./src/exit_code.ts"),o=s("./src/utils.ts"),a=s("./src/version.ts");class c extends r.BuiltinCommand{get name(){return"cockle-config"}async _run(t){const{stdout:e}=t;return e.write(`cockle ${a.COCKLE_VERSION}\n`),this._writePackageConfig(t),i.ExitCode.SUCCESS}_writePackageConfig(t){const{commandRegistry:e,stdout:s}=t,r=e.wasmPackageMap,i=[["package","version","build string","channel"]];for(const t of r.values())i.push([t.name,t.version,t.build_string,t.channel]);let a=null;s.supportsAnsiEscapes()&&(a=new Map,a.set(1,n.ansi.styleBrightBlue),a.set(2,n.ansi.styleBrightPurple),a.set(3,n.ansi.styleGreen));for(const t of(0,o.toTable)(i,1,!1,a))s.write(t+"\n")}}},"./src/builtin/exit_command.ts":function(t,e,s){s.r(e),s.d(e,{ExitCommand:function(){return i}});var r=s("./src/builtin/builtin_command.ts"),n=s("./src/exit_code.ts");class i extends r.BuiltinCommand{get name(){return"exit"}async _run(t){const{stdout:e,terminate:s}=t;return e.write("Terminating shell...\n"),e.flush(),s(),n.ExitCode.SUCCESS}}},"./src/builtin/export_command.ts":function(t,e,s){s.r(e),s.d(e,{ExportCommand:function(){return c}});var r=s("./src/builtin/builtin_command.ts"),n=s("./src/builtin/option.ts"),i=s("./src/builtin/options.ts"),o=s("./src/exit_code.ts");class a extends i.Options{trailingStrings=new n.TrailingStringsOption(0)}class c extends r.BuiltinCommand{get name(){return"export"}async _run(t){const{args:e,environment:s}=t,r=i.Options.fromArgs(e,a);if(r.trailingStrings.isSet)for(const t of r.trailingStrings.strings){const e=t.indexOf("=");if(e>0){const r=t.slice(0,e),n=t.slice(e+1);s.set(r,n)}}return o.ExitCode.SUCCESS}}},"./src/builtin/history_command.ts":function(t,e,s){s.r(e),s.d(e,{HistoryCommand:function(){return c}});var r=s("./src/builtin/builtin_command.ts"),n=s("./src/builtin/option.ts"),i=s("./src/builtin/options.ts"),o=s("./src/exit_code.ts");class a extends i.Options{clear=new n.BooleanOption("c","","clear the history by deleting all of the entries");help=new n.BooleanOption("","help","display this help and exit")}class c extends r.BuiltinCommand{get name(){return"history"}async _run(t){const{args:e,history:s,stdout:r}=t,n=i.Options.fromArgs(e,a);return n.help.isSet?n.writeHelp(r):n.clear.isSet?s.clear():s.write(r),o.ExitCode.SUCCESS}}},"./src/builtin/index.ts":function(t,e,s){s.r(e),s.d(e,{AliasCommand:function(){return r.AliasCommand},BuiltinCommand:function(){return n.BuiltinCommand},CdCommand:function(){return i.CdCommand},ClearCommand:function(){return o.ClearCommand},CockleConfigCommand:function(){return a.CockleConfigCommand},ExitCommand:function(){return c.ExitCommand},ExportCommand:function(){return u.ExportCommand},HistoryCommand:function(){return l.HistoryCommand}});var r=s("./src/builtin/alias_command.ts"),n=s("./src/builtin/builtin_command.ts"),i=s("./src/builtin/cd_command.ts"),o=s("./src/builtin/clear_command.ts"),a=s("./src/builtin/cockle_config_command.ts"),c=s("./src/builtin/exit_command.ts"),u=s("./src/builtin/export_command.ts"),l=s("./src/builtin/history_command.ts")},"./src/builtin/option.ts":function(t,e,s){s.r(e),s.d(e,{BooleanOption:function(){return i},Option:function(){return n},TrailingStringsOption:function(){return o}});var r=s("./src/error_exit_code.ts");class n{shortName;longName;description;constructor(t,e,s){this.shortName=t,this.longName=e,this.description=s}get isSet(){return this._isSet}get name(){return this.shortName?this.shortName:this.longName}get prefixedName(){return this.shortName?`-${this.shortName}`:`--${this.longName}`}set(){this._isSet=!0}_isSet=!1}class i extends n{constructor(t,e,s){super(t,e,s)}}class o extends n{minCount;constructor(t=1){if(super("","",""),this.minCount=t,t<0)throw new r.GeneralError("Negative minCount in TrailingStringsOption.constructor")}add(t){this._strings.push(t),this._isSet=!0}get length(){return this._strings.length}get strings(){return this._strings}_strings=[]}},"./src/builtin/options.ts":function(t,e,s){s.r(e),s.d(e,{Options:function(){return n}});var r=s("./src/error_exit_code.ts");class n{static fromArgs(t,e){const s=new e,n=s._getStrings();let i=!1;for(const e of t)if(e.startsWith("-")&&e.length>1){if(i)throw new r.GeneralError("Cannot have named option after parsing a trailing path");if(e.startsWith("--")){const t=e.slice(2);s._findByLongName(t).set()}else{const t=e.slice(1);s._findByShortName(t).set()}}else{if(null===n)throw new r.GeneralError(`Unrecognised option: ${e}`);n.add(e),i=!0}if(n&&n.length<n.minCount)throw new r.GeneralError("Insufficient trailing strings options specified");return s}writeHelp(t){for(const e of this._help())t.write(`${e}\n`)}_findByLongName(t){let e;for(e of Object.values(this))if(e.longName===t)return e;throw new r.GeneralError(`No such longName option '${t}'`)}_findByShortName(t){let e;for(e of Object.values(this))if(e.shortName===t)return e;throw new r.GeneralError(`No such shortName option '${t}'`)}_getStrings(){return"trailingStrings"in this?this.trailingStrings:null}_help(){return[...Object.values(this)].sort(((t,e)=>t.name>e.name?1:-1)).map((t=>{const e=t.prefixedName,s=Math.max(1,12-e.length);return`    ${e}${" ".repeat(s)}${t.description}`}))}}},"./src/command_registry.ts":function(t,e,s){s.r(e),s.d(e,{CommandRegistry:function(){return n}});var r=s("./src/builtin/index.ts");class n{constructor(t){this.registerBuiltinCommands(r)}get(t){return this._map.get(t)??null}match(t){return[...this._map.keys()].filter((e=>e.startsWith(t))).sort()}registerBuiltinCommands(t){for(const[e,s]of Object.entries(t))if(e.endsWith("Command")&&!e.startsWith("Builtin"))try{const t=new s;t instanceof r.BuiltinCommand&&this._register(t)}catch{}}registerWasmCommandPackage(t){this.wasmPackageMap.set(t.name,t);for(const e of t.modules)this._register(e)}_register(t){for(const e of t.names())this._map.set(e,t)}_map=new Map;wasmPackageMap=new Map}},"./src/commands/wasm_command_module.ts":function(t,e,s){s.r(e),s.d(e,{WasmCommandModule:function(){return n}});var r=s("./src/commands/wasm_command_runner.ts");class n extends r.WasmCommandRunner{name;commands;constructor(t,e,s){super(t),this.name=e,this.commands=s}moduleName(){return this.name}names(){return this.commands}}},"./src/commands/wasm_command_package.ts":function(t,e,s){s.r(e),s.d(e,{WasmCommandPackage:function(){return r}});class r{name;version;build_string;channel;platform;modules;constructor(t,e,s,r,n,i){this.name=t,this.version=e,this.build_string=s,this.channel=r,this.platform=n,this.modules=i}}},"./src/commands/wasm_command_runner.ts":function(t,e,s){s.r(e),s.d(e,{WasmCommandRunner:function(){return n}});var r=s("./src/exit_code.ts");class n{wasmLoader;constructor(t){this.wasmLoader=t}async run(t,e){const{args:s,bufferedIO:n,fileSystem:i,mountpoint:o,stdin:a,stdout:c,stderr:u}=e,{wasmBaseUrl:l}=this.wasmLoader,h=Date.now(),d=this.wasmLoader.getModule(this.moduleName());let f,m=[];function _(t){if(m.length>0)return m.shift();const e=a.readChar(),s=e[0];return e.length>1&&(m=e.slice(1)),4===s?null:s}function p(t){return n.termios.clone()}function g(t,e,s){return n.termios.set(s),0}function C(t){return[e.environment.getNumber("LINES")??24,e.environment.getNumber("COLUMNS")??80]}function y(t,e){return n.poll(e)}function E(e,r,i,o,a){if(0===o)return 0;const l=r.slice(i,i+o),h=n.utf8ArrayToString(l),d="/dev/tty1"===e.path;return d&&"touch"===t&&s.length>1||(d?u:c).write(h),o}const w=await d({thisProgram:t,arguments:s,locateFile:t=>l+t,quit:(t,e)=>{void 0===f&&(f=t)},preRun:[t=>{if(Object.prototype.hasOwnProperty.call(t,"FS")){const e=t.FS;e.mkdir(o,511),e.mount(i.PROXYFS,{root:o,fs:i.FS},o),e.chdir(i.FS.cwd())}if(Object.prototype.hasOwnProperty.call(t,"ENV")&&e.environment.copyIntoCommand(t.ENV,c.supportsAnsiEscapes()),Object.prototype.hasOwnProperty.call(t,"TTY")){t.TTY.default_tty_ops.ioctl_tcgets=p,t.TTY.default_tty_ops.ioctl_tcsets=g,t.TTY.default_tty_ops.ioctl_tiocgwinsz=C,t.TTY.stream_ops.write=E,t.TTY.stream_ops.poll=y;const e=t.FS.makedev(5,0);t.TTY.ttys[e].ops.get_char=_}}]});if(void 0===f)f=r.ExitCode.CANNOT_RUN_COMMAND;else{if(Object.prototype.hasOwnProperty.call(w,"FS")){const t=w.FS;t.close(t.streams[1]),t.close(t.streams[2])}Object.prototype.hasOwnProperty.call(w,"getEnvStrings")&&e.environment.copyFromCommand(w.getEnvStrings())}const S=Date.now();return console.log(`${t} load and run time ${S-h} ms`),f}}},"./src/context.ts":function(t,e,s){s.r(e),s.d(e,{Context:function(){return r}});class r{args;fileSystem;mountpoint;aliases;commandRegistry;environment;history;terminate;stdin;stdout;stderr;bufferedIO;constructor(t,e,s,r,n,i,o,a,c,u,l,h){this.args=t,this.fileSystem=e,this.mountpoint=s,this.aliases=r,this.commandRegistry=n,this.environment=i,this.history=o,this.terminate=a,this.stdin=c,this.stdout=u,this.stderr=l,this.bufferedIO=h}flush(){this.stderr.flush(),this.stdout.flush()}}},"./src/environment.ts":function(t,e,s){s.r(e),s.d(e,{Environment:function(){return n}});var r=s("./src/ansi.ts");class n extends Map{constructor(t){super(),t?(this.set("PS1",r.ansi.styleBoldGreen+"js-shell:"+r.ansi.styleReset+" "),this.set("TERM","xterm-256color")):this.set("PS1","js-shell: ")}copyFromCommand(t){for(const e of t){const t=e.split("="),s=t.shift();s&&!this._ignore.has(s)&&this.set(s,t.join("="))}}copyIntoCommand(t,e){for(const[s,r]of this.entries())(e||"TERM"!==s)&&(t[s]=r)}getNumber(t){const e=this.get(t);if(null===e)return null;const s=Number(e);return isNaN(s)?null:s}getPrompt(){return this.get("PS1")??"$ "}_ignore=new Set(["USER","LOGNAME","HOME","LANG","_"])}},"./src/error_exit_code.ts":function(t,e,s){s.r(e),s.d(e,{ErrorExitCode:function(){return n},FindCommandError:function(){return i},GeneralError:function(){return o},ImproperUseError:function(){return a}});var r=s("./src/exit_code.ts");class n extends Error{exitCode;constructor(t,e){super(e),this.exitCode=t}}class i extends n{constructor(t){super(r.ExitCode.CANNOT_FIND_COMMAND,`'${t}': command not found`)}}class o extends n{constructor(t){super(r.ExitCode.GENERAL_ERROR,t)}}class a extends n{constructor(t){super(r.ExitCode.IMPROPER_USE,t)}}},"./src/exit_code.ts":function(t,e,s){s.r(e),s.d(e,{ExitCode:function(){return r}});const r={SUCCESS:0,GENERAL_ERROR:1,IMPROPER_USE:2,CANNOT_RUN_COMMAND:126,CANNOT_FIND_COMMAND:127}},"./src/history.ts":function(t,e,s){s.r(e),s.d(e,{History:function(){return r}});class r{add(t){this._current=null,!t.trim()||this._ignoreInitialWhitespace&&t.startsWith(" ")||this._ignoreDuplicates&&t===this.at(-1)||(this._history.length>=this._maxSize&&this._history.shift(),this._history.push(t))}at(t){return this._history.at(t)??null}clear(){this._current=null,this._history=[]}scrollCurrent(t){return this._current=t?null===this._current?null:this._current+1:null===this._current?this._history.length-1:this._current-1,null!==this._current&&(this._current<0?this._current=0:this._current>=this._history.length&&(this._current=null)),null===this._current?null:this.at(this._current)}setMaxSize(t){this._maxSize=Math.max(t,0),this._history.length>this._maxSize&&(this._current=null,this._history=this._history.slice(this._maxSize))}async write(t){for(let e=0;e<this._history.length;e++){const s=String(e).padStart(5," ");t.write(`${s}  ${this._history[e]}\n`)}}_history=[];_current=null;_ignoreInitialWhitespace=!0;_ignoreDuplicates=!0;_maxSize=1e3}},"./src/io/buffered_output.ts":function(t,e,s){s.r(e),s.d(e,{BufferedOutput:function(){return r}});class r{get allContent(){return this.data.join("")}clear(){this.data=[]}supportsAnsiEscapes(){return!1}write(t){this.data.push(t)}data=[]}},"./src/io/console_output.ts":function(t,e,s){s.r(e),s.d(e,{ConsoleOutput:function(){return r}});class r{flush(){}supportsAnsiEscapes(){return!1}write(t){console.log(t)}}},"./src/io/file_input.ts":function(t,e,s){s.r(e),s.d(e,{FileInput:function(){return n}});var r=s("./src/io/input_all.ts");class n extends r.InputAll{fileSystem;path;constructor(t,e){super(),this.fileSystem=t,this.path=e}readAll(){const{FS:t}=this.fileSystem;return t.readFile(this.path,{encoding:"utf8"})}}},"./src/io/file_output.ts":function(t,e,s){s.r(e),s.d(e,{FileOutput:function(){return n}});var r=s("./src/io/buffered_output.ts");class n extends r.BufferedOutput{fileSystem;path;append;constructor(t,e,s){super(),this.fileSystem=t,this.path=e,this.append=s}flush(){const{FS:t}=this.fileSystem;let e=this.allContent;if(this.append)try{e=t.readFile(this.path,{encoding:"utf8"})+e}catch(t){}t.writeFile(this.path,e,{mode:436}),this.clear()}}},"./src/io/index.ts":function(t,e,s){s.r(e),s.d(e,{BufferedOutput:function(){return r.BufferedOutput},ConsoleOutput:function(){return n.ConsoleOutput},FileInput:function(){return i.FileInput},FileOutput:function(){return o.FileOutput},InputAll:function(){return a.InputAll},Pipe:function(){return c.Pipe},PipeInput:function(){return u.PipeInput},RedirectOutput:function(){return l.RedirectOutput},TerminalInput:function(){return h.TerminalInput},TerminalOutput:function(){return d.TerminalOutput}});var r=s("./src/io/buffered_output.ts"),n=s("./src/io/console_output.ts"),i=s("./src/io/file_input.ts"),o=s("./src/io/file_output.ts"),a=(s("./src/io/input.ts"),s("./src/io/input_all.ts")),c=(s("./src/io/output.ts"),s("./src/io/pipe.ts")),u=s("./src/io/pipe_input.ts"),l=s("./src/io/redirect_output.ts"),h=s("./src/io/terminal_input.ts"),d=s("./src/io/terminal_output.ts")},"./src/io/input.ts":function(t,e,s){s.r(e)},"./src/io/input_all.ts":function(t,e,s){s.r(e),s.d(e,{InputAll:function(){return r}});class r{isTerminal(){return!1}readChar(){if(void 0===this._buffer&&(this._buffer=this.readAll(),this._index=0),this._index<this._buffer.length){const t=this._buffer[this._index++],e=[];for(let s=0;s<t.length;s++)e.push(t.charCodeAt(s));return e}return[4]}_buffer;_index=0}},"./src/io/output.ts":function(t,e,s){s.r(e)},"./src/io/pipe.ts":function(t,e,s){s.r(e),s.d(e,{Pipe:function(){return i}});var r=s("./src/io/buffered_output.ts"),n=s("./src/io/pipe_input.ts");class i extends r.BufferedOutput{flush(){}get input(){return new n.PipeInput(this)}}},"./src/io/pipe_input.ts":function(t,e,s){s.r(e),s.d(e,{PipeInput:function(){return n}});var r=s("./src/io/input_all.ts");class n extends r.InputAll{pipe;constructor(t){super(),this.pipe=t}readAll(){const t=this.pipe.allContent;return this.pipe.clear(),t}}},"./src/io/redirect_output.ts":function(t,e,s){s.r(e),s.d(e,{RedirectOutput:function(){return n}});var r=s("./src/io/buffered_output.ts");class n extends r.BufferedOutput{constructor(t){super(),this.target=t}flush(){this.data.forEach((t=>this.target.write(t))),this.clear(),this.target.flush()}target}},"./src/io/terminal_input.ts":function(t,e,s){s.r(e),s.d(e,{TerminalInput:function(){return r}});class r{stdinCallback;constructor(t){this.stdinCallback=t}isTerminal(){return!0}readChar(){if(this._finished||void 0===this.stdinCallback)return[4];{const t=this.stdinCallback();if(4===t[0])this._finished=!0;else if(13===t[0])return[10];return t}}_finished=!1}},"./src/io/terminal_output.ts":function(t,e,s){s.r(e),s.d(e,{TerminalOutput:function(){return r}});class r{outputCallback;prefix;suffix;constructor(t,e=null,s=null){this.outputCallback=t,this.prefix=e,this.suffix=s}flush(){}supportsAnsiEscapes(){return!0}write(t){t.length<1||(null!==this.prefix&&(t=this.prefix+t),null!==this.suffix&&(t+=this.suffix),this.outputCallback(t))}}},"./src/parse.ts":function(t,e,s){s.r(e),s.d(e,{CommandNode:function(){return a},Node:function(){return o},PipeNode:function(){return c},RedirectNode:function(){return u},parse:function(){return l}});var r=s("./src/error_exit_code.ts"),n=s("./src/tokenize.ts");const i=";&";class o{}class a extends o{name;suffix;redirects;constructor(t,e,s){super(),this.name=t,this.suffix=e,this.redirects=s}lastToken(){return this.redirects&&this.redirects.length>0?this.redirects[this.redirects.length-1].lastToken():this.suffix.length>0?[this.suffix[this.suffix.length-1],!1]:[this.name,!0]}}class c extends o{commands;constructor(t){super(),this.commands=t}lastToken(){return this.commands.length>0?this.commands[this.commands.length-1].lastToken():[null,!1]}}class u extends o{token;target;constructor(t,e){super(),this.token=t,this.target=e}lastToken(){return[this.target,!1]}}function l(t,e=!0,s){const r=(0,n.tokenize)(t,e,s),o=[],a=[];let u=-1;const l=r.length;function d(){1===a.length?o.push(a[0]):a.length>1&&o.push(new c([...a])),a.length=0}for(let t=0;t<l;t++){const e=r[t];u>=0?i.includes(e.value)?(a.push(h(r.slice(u,t))),d(),u=-1):"|"===e.value&&(a.push(h(r.slice(u,t))),u=-1):i.includes(e.value)||(u=t)}return u>=0&&a.push(h(r.slice(u,l))),d(),o}function h(t){let e=t.slice(1);const s=e.findIndex((t=>{return(e=t.value).startsWith(">")||e.startsWith("<");var e}));if(s>=0){if(e.length!==s+2)throw new r.GeneralError("Redirect should be followed by file to redirect to");const n=new u(e[s],e[s+1]);return e=e.slice(0,s),new a(t[0],e,[n])}return new a(t[0],e)}},"./src/shell_impl.ts":function(t,e,s){s.r(e),s.d(e,{ShellImpl:function(){return C}});var r=s("./node_modules/@jupyterlite/contents/lib/drivefs.js"),n=s("./src/aliases.ts"),i=s("./src/ansi.ts"),o=s("./src/command_registry.ts"),a=s("./src/context.ts"),c=s("./src/environment.ts"),u=s("./src/error_exit_code.ts"),l=s("./src/exit_code.ts"),h=s("./src/history.ts"),d=s("./src/io/index.ts"),f=s("./src/parse.ts"),m=s("./src/utils.ts"),_=s("./src/wasm_loader.ts"),p=s("./src/commands/wasm_command_module.ts"),g=s("./src/commands/wasm_command_package.ts");class C{options;constructor(t){this.options=t,this._environment=new c.Environment(t.color),this._wasmLoader=new _.WasmLoader(t.wasmBaseUrl),this._commandRegistry=new o.CommandRegistry(this._wasmLoader)}get aliases(){return this._aliases}get environment(){return this._environment}get history(){return this._history}async initialize(){await this._initWasmPackages(),await this._initFilesystem()}async input(t){if(!this._isRunning)return;const e=t.charCodeAt(0);if(13===e){this.output("\n");const t=this._currentLine;this._currentLine="",this._cursorIndex=0,await this._runCommands(t),await this._outputPrompt()}else if(127===e){if(this._cursorIndex>0){const t=this._currentLine.slice(this._cursorIndex);this._currentLine=this._currentLine.slice(0,this._cursorIndex-1)+t,this._cursorIndex--,this.output(i.ansi.cursorLeft(1)+t+i.ansi.eraseEndLine+i.ansi.cursorLeft(t.length))}}else if(9===e)await this._tabComplete();else if(27===e){const e=t.slice(1);if("[A"===e||"[1A"===e||"[B"===e||"[1B"===e){const t=this._history.scrollCurrent(e.endsWith("B"));this._currentLine=null!==t?t:"",this._cursorIndex=this._currentLine.length,this.output(i.ansi.eraseStartLine+`\r${this._environment.getPrompt()}${this._currentLine}`)}else if("[D"===e||"[1D"===e)this._cursorIndex>0&&(this._cursorIndex--,this.output(i.ansi.cursorLeft()));else if("[C"===e||"[1C"===e)this._cursorIndex<this._currentLine.length&&(this._cursorIndex++,this.output(i.ansi.cursorRight()));else if("[3~"===e){if(this._cursorIndex<this._currentLine.length){const t=this._currentLine.slice(this._cursorIndex+1);this._currentLine=this._currentLine.slice(0,this._cursorIndex)+t,this.output(i.ansi.eraseEndLine+t+i.ansi.cursorLeft(t.length))}}else if("[H"===e||"[1;2H"===e)this._cursorIndex>0&&(this.output(i.ansi.cursorLeft(this._cursorIndex)),this._cursorIndex=0);else if("[F"===e||"[1;2F"===e){const{length:t}=this._currentLine;this._cursorIndex<t&&(this.output(i.ansi.cursorRight(t-this._cursorIndex)),this._cursorIndex=t)}else if("[1;2D"===e||"[1;5D"===e){if(this._cursorIndex>0){const t=this._currentLine.slice(0,this._cursorIndex).trimEnd().lastIndexOf(" ")+1;this.output(i.ansi.cursorLeft(this._cursorIndex-t)),this._cursorIndex=t}}else if("[1;2C"===e||"[1;5C"===e){const{length:t}=this._currentLine;if(this._cursorIndex<t-1){const e=this._currentLine.slice(this._cursorIndex),s=e.trimStart(),r=s.indexOf(" "),n=r<0?t:this._cursorIndex+e.length-s.length+r;this.output(i.ansi.cursorRight(n-this._cursorIndex)),this._cursorIndex=n}}}else if(4===e);else{if(this._cursorIndex===this._currentLine.length)this._currentLine+=t,this.output(t);else{const e=this._currentLine.slice(this._cursorIndex);this._currentLine=this._currentLine.slice(0,this._cursorIndex)+t+e,this.output(i.ansi.eraseEndLine+t+e+i.ansi.cursorLeft(e.length))}this._cursorIndex++}}get mountpoint(){return this.options.mountpoint??"/drive"}output(t){this._isRunning&&this.options.bufferedIO.write(t)}async setSize(t,e){if(!this._isRunning)return;const{environment:s}=this;t>=1?s.set("LINES",t.toString()):s.delete("LINES"),e>=1?s.set("COLUMNS",e.toString()):s.delete("COLUMNS")}async start(){this._isRunning=!0,await this._outputPrompt()}terminate(){console.log("ShellImpl.terminate"),this._isRunning=!1,this.options.terminateCallback()}_filenameExpansion(t){let e=[],s=0;for(const r of t){if(r.startsWith("-")){s++,e.push(r);continue}if(!r.includes("*")&&!r.includes("?")){e.push(r);continue}const{FS:t}=this._fileSystem,n=t.analyzePath(r,!1);if(!n.parentExists){e.push(r);continue}const i=n.parentPath;let o=i;const a=t.cwd();o.startsWith(a)&&(o=o.slice(a.length),o.startsWith("/")&&(o=o.slice(1)));let c=t.readdir(i),u=n.name.replace(/[.+^${}()|[\]\\]/g,"\\$&");u=u.replaceAll("*",".*"),u=u.replaceAll("?",".");const l=new RegExp(`^${u}$`);c=c.filter((t=>t.match(l))),c=c.filter((t=>!t.startsWith("."))),o.length>0&&(c=c.map((t=>o+"/"+t))),e=e.concat(c)}return e.length===s&&(e=t),e}async _initFilesystem(){const{wasmBaseUrl:t}=this.options,e=this._wasmLoader.getModule("fs"),s=await e({locateFile:e=>t+e}),{FS:n,PATH:i,ERRNO_CODES:o,PROXYFS:a}=s,{mountpoint:c}=this;n.mkdir(c,511),this._fileSystem={FS:n,PATH:i,ERRNO_CODES:o,PROXYFS:a};const{driveFsBaseUrl:u,initialDirectories:l,initialFiles:h}=this.options;u&&(this._driveFS=new r.DriveFS({FS:n,PATH:i,ERRNO_CODES:o,baseUrl:u,driveName:"",mountpoint:c}),n.mount(this._driveFS,{},c)),n.chdir(c),this._environment.set("PWD",n.cwd()),l&&l.forEach((t=>n.mkdir(t,509))),h&&Object.entries(h).forEach((([t,e])=>n.writeFile(t,e,{mode:436})))}async _initWasmPackages(){const t=this.options.wasmBaseUrl+"cockle-config.json",e=await fetch(t);e.ok||console.error(`Failed to fetch ${t}, terminal cannot function without it`);const s=await e.json(),r="cockle_fs";s.map((t=>t.package)).includes(r)||console.error(`cockle-config.json does not include required package '${r}'`);for(const t of s){const e=t.modules.map((t=>new p.WasmCommandModule(this._wasmLoader,t.name,t.commands?t.commands.split(","):[]))),s=new g.WasmCommandPackage(t.package,t.version,t.build_string,t.channel,t.platform,e);this._commandRegistry.registerWasmCommandPackage(s)}}_outputPrompt(){this._isRunning&&this.options.bufferedIO.write(`\n${this.environment.getPrompt()}`)}async _runCommands(t){if(this.options.enableBufferedStdinCallback(!0),this.options.bufferedIO.allowAdjacentNewline(!0),t.startsWith("!")){const e=parseInt(t.slice(1)),s=this._history.at(e);if(null===s){let t="!"+e+": event not found";return this.options.color&&(t=i.ansi.styleBoldRed+t+i.ansi.styleReset),this.output(`${t}\n`),void this._outputPrompt()}t=s}let e;this._history.add(t);const s=new d.TerminalInput(this.options.stdinCallback),r=new d.TerminalOutput(this.output.bind(this)),n=new d.TerminalOutput(this.output.bind(this),this.options.color?i.ansi.styleBoldRed:null,this.options.color?i.ansi.styleReset:null);try{const i=(0,f.parse)(t,!0,this._aliases);for(const t of i)if(t instanceof f.CommandNode)e=await this._runCommand(t,s,r,n);else{if(!(t instanceof f.PipeNode))throw new u.GeneralError(`Expected CommandNode or PipeNode not ${t}`);{const{commands:e}=t,i=e.length;let o;for(let t=0;t<i;t++){const a=0===t?s:o.input,c=t<i-1?o=new d.Pipe:r;await this._runCommand(e[t],a,c,n)}}}}catch(t){t instanceof u.ErrorExitCode&&(e=t.exitCode),n.write(t+"\n"),n.flush()}finally{e=e??l.ExitCode.GENERAL_ERROR,this.environment.set("?",`${e}`),this.options.bufferedIO.allowAdjacentNewline(!1),this.options.enableBufferedStdinCallback(!1)}}async _runCommand(t,e,s,r){const n=t.name.value,i=this._commandRegistry.get(n);if(null===i)throw new u.FindCommandError(n);if(t.redirects){if(t.redirects.length>1)throw new u.GeneralError("Only implemented a single redirect per command");const r=t.redirects[0],n=r.token.value,i=r.target.value;if(">"===n||">>"===n)s=new d.FileOutput(this._fileSystem,i,">>"===n);else{if("<"!==n)throw new u.GeneralError("Unrecognised redirect "+n);e=new d.FileInput(this._fileSystem,i)}}let o=t.suffix.map((t=>t.value));o=this._filenameExpansion(o);const c=new a.Context(o,this._fileSystem,this.mountpoint,this._aliases,this._commandRegistry,this._environment,this._history,this.terminate.bind(this),e,s,r,this.options.bufferedIO),l=await i.run(n,c);return c.flush(),l}async _tabComplete(){const t=this._currentLine.slice(0,this._cursorIndex);if(t.endsWith(" ")&&t.trim().length>0)return;const e=this._currentLine.slice(this._cursorIndex),s=(0,f.parse)(t,!1),[r,n]=s.length>0?s[s.length-1].lastToken():[null,!0];let o=r?.value??"",a=[];if(n){const t=this._commandRegistry.match(o),e=this._aliases.match(o);a=[...new Set([...t,...e])].sort()}else{const{FS:t}=this._fileSystem,e=t.analyzePath(o,!1);if(!e.parentExists)return;const s=o;o=e.name;const{exists:r}=e;if(r&&!t.isDir(t.stat(e.path).mode))a=[o];else{const n=r?e.path:e.parentPath;a=t.readdir(n),r?"."===s||".."===s||s.endsWith("/.")||s.endsWith("/..")?a=a.filter((t=>t.startsWith("."))):(a=a.filter((t=>!t.startsWith("."))),s.endsWith("/")||(this._currentLine+="/")):a=a.filter((t=>t.startsWith(o))),a=a.map((e=>t.isDir(t.stat(n+"/"+e).mode)?e+"/":e))}}if(1===a.length){let t=a[0].slice(o.length);t.endsWith("/")||(t+=" "),this._currentLine=this._currentLine.slice(0,this._cursorIndex)+t+e,this._cursorIndex+=t.length,this.output(t+e+i.ansi.cursorLeft(e.length))}else if(a.length>1){const t=(0,m.longestStartsWith)(a,o.length);if(t.length>o.length){const s=t.slice(o.length);this._currentLine=this._currentLine.slice(0,this._cursorIndex)+s+e,this._cursorIndex+=s.length,this.output(s+e+i.ansi.cursorLeft(e.length))}else{const t=`\n${(0,m.toColumns)(a,this._environment.getNumber("COLUMNS")??0).join("\n")}\n${this._environment.getPrompt()}${this._currentLine}`;this.output(t+i.ansi.cursorLeft(e.length))}}}_currentLine="";_cursorIndex=0;_isRunning=!1;_aliases=new n.Aliases;_commandRegistry;_environment;_history=new h.History;_wasmLoader;_fileSystem;_driveFS}},"./src/termios.ts":function(t,e,s){var r,n,i,o;s.r(e),s.d(e,{ControlCharacter:function(){return o},InputFlag:function(){return r},LocalFlag:function(){return i},OutputFlag:function(){return n},Termios:function(){return a}}),function(t){t[t.ISTRIP=32]="ISTRIP",t[t.INLCR=64]="INLCR",t[t.IGNCR=128]="IGNCR",t[t.ICRNL=256]="ICRNL",t[t.IUCLC=512]="IUCLC",t[t.IXON=1024]="IXON",t[t.IXANY=2048]="IXANY",t[t.IMAXBEL=8192]="IMAXBEL",t[t.IUTF8=16384]="IUTF8"}(r||(r={})),function(t){t[t.OPOST=1]="OPOST",t[t.OLCUC=2]="OLCUC",t[t.ONLCR=4]="ONLCR",t[t.OCRNL=8]="OCRNL",t[t.ONOCR=16]="ONOCR",t[t.ONLRET=32]="ONLRET",t[t.TABDLY=6144]="TABDLY"}(n||(n={})),function(t){t[t.ISIG=1]="ISIG",t[t.ICANON=2]="ICANON",t[t.ECHO=8]="ECHO",t[t.ECHOE=16]="ECHOE",t[t.ECHOK=32]="ECHOK",t[t.ECHONL=64]="ECHONL",t[t.NOFLSH=128]="NOFLSH",t[t.ECHOCTL=512]="ECHOCTL",t[t.ECHOPRT=1024]="ECHOPRT",t[t.ECHOKE=2048]="ECHOKE",t[t.IEXTEN=32768]="IEXTEN"}(i||(i={})),function(t){t[t.VINTR=0]="VINTR",t[t.VQUIT=1]="VQUIT",t[t.VERASE=2]="VERASE",t[t.VKILL=3]="VKILL",t[t.VEOF=4]="VEOF",t[t.VTIME=5]="VTIME",t[t.VMIN=6]="VMIN",t[t.VSWTCH=7]="VSWTCH",t[t.VSTART=8]="VSTART",t[t.VSTOP=9]="VSTOP",t[t.VSUSP=10]="VSUSP",t[t.VEOL=11]="VEOL",t[t.VREPRINT=12]="VREPRINT",t[t.VDISCARD=13]="VDISCARD",t[t.VWERASE=14]="VWERASE",t[t.VLNEXT=15]="VLNEXT",t[t.VEOL2=16]="VEOL2"}(o||(o={}));class a{clone(){return{c_iflag:this.c_iflag,c_oflag:this.c_oflag,c_cflag:this.c_cflag,c_lflag:this.c_lflag,c_cc:[...this.c_cc]}}log(){const t=(t,e,s)=>{const r=[];for(const[e,n]of Object.entries(t).filter((([t,e])=>t[0].match(/\D/))))(s&n)>0&&r.push(e);return`  ${e} = ${s} 0x${s.toString(16)} = ${r.join(" ")}`},e=["Termios:"];e.push(t(r,"c_iflag",this.c_iflag)),e.push(t(n,"c_oflag",this.c_oflag)),e.push(`  c_cflag = ${this.c_cflag} 0x${this.c_cflag.toString(16)}`),e.push(t(i,"c_lflag",this.c_lflag)),e.push(`  c_cc = ${this.c_cc}`),console.log(e.join("\n"))}static newDefaultWasm(){const t=new a;return t.setDefaultWasm(),t}set(t){this.c_iflag=t.c_iflag,this.c_oflag=t.c_oflag,this.c_cflag=t.c_cflag,this.c_lflag=t.c_lflag,this.c_cc=[...t.c_cc],this.log()}setDefaultWasm(){this.c_iflag=r.IUTF8|r.IMAXBEL|r.IXON|r.ICRNL,this.c_oflag=n.OPOST|n.ONLCR,this.c_cflag=191,this.c_lflag=i.IEXTEN|i.ECHOKE|i.ECHOCTL|i.ECHOK|i.ECHOE|i.ECHO|i.ICANON|i.ISIG,this.c_cc=[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.log()}c_iflag=0;c_oflag=0;c_cflag=0;c_lflag=0;c_cc=[]}},"./src/tokenize.ts":function(t,e,s){s.r(e),s.d(e,{tokenize:function(){return i}});var r,n=s("./src/error_exit_code.ts");function i(t,e=!0,s){const r=new o(t,e,s);return r.run(),r.tokens}!function(t){t[t.None=0]="None",t[t.Delimiter=1]="Delimiter",t[t.DoubleQuote=2]="DoubleQuote",t[t.SingleQuote=3]="SingleQuote",t[t.Whitespace=4]="Whitespace",t[t.Other=5]="Other"}(r||(r={}));class o{throwErrors;aliases;constructor(t,e,s){this.throwErrors=e,this.aliases=s,this._source=t,this._tokens=[]}run(){for(;this._index<=this._source.length;)this._next();if(this.throwErrors&&""!==this._endQuote)throw new n.GeneralError("Tokenize error, expected end quote "+this._endQuote)}get tokens(){return this._tokens}_addToken(){const t=this._offset,e=this._value;if(void 0!==this.aliases&&t!==this._aliasOffset&&(0===this._tokens.length||";&|".includes(this._tokens.at(-1).value.at(-1)))){const s=this.aliases.getRecursive(e);if(void 0!==s){const n=e.length;return this._offset=-1,this._index=t-1,this._aliasOffset=t,this._source=this._source.slice(0,t)+s+this._source.slice(t+n),this._prevChar="",this._prevCharType=r.None,this._value="",this._endQuote="",!1}}return this._tokens.push({offset:t,value:e}),this._endQuote="",!0}_getCharType(t){return" ".includes(t)?r.Whitespace:";&|><".includes(t)?r.Delimiter:"'"===t?r.SingleQuote:'"'===t?r.DoubleQuote:r.Other}_endQuoteFromCharType(t){return t===r.DoubleQuote?'"':t===r.SingleQuote?"'":""}_next(){const t=++this._index,e=t<this._source.length?this._source[t]:" ";let s=this._getCharType(e);const n=this._endQuoteFromCharType(s);this._offset>=0?this._endQuote?e!==this._endQuote?this._value+=e:(this._endQuote="",s=r.Other):n?this._endQuote=n:s===r.Whitespace?this._addToken()&&(this._offset=-1):s!==this._prevCharType||s===r.Delimiter&&e!==this._prevChar?this._addToken()&&(this._offset=t,this._value=e):this._value+=e:s!==r.Whitespace&&(this._offset=t,this._endQuote=this._endQuoteFromCharType(s),this._value=""===this._endQuote?e:""),this._prevChar=e,this._prevCharType=s}_source;_tokens;_prevChar="";_prevCharType=r.None;_index=-1;_offset=-1;_aliasOffset=-1;_value="";_endQuote=""}},"./src/utils.ts":function(t,e,s){s.r(e),s.d(e,{longestStartsWith:function(){return n},toColumns:function(){return i},toTable:function(){return o}});var r=s("./src/ansi.ts");function n(t,e=0){if(t.length<1)return"";const s=Math.min(...t.map((t=>t.length))),r=t[0];let n=e;for(;n<s&&t.every((t=>t[n]===r[n]));)n++;return r.slice(0,n)}function i(t,e){if(t.length<1)return[];if(e<1)return[t.join("  ")];const s=t.length,r=Math.max(...t.map((t=>t.length))),n=Math.min(Math.floor(e/(r+2)),s),i=Math.ceil(s/n),o=[];for(let e=0;e<i;++e){let a="";for(let o=0;o<n;++o){const n=o*i+e;if(n>=s)continue;const c=t[n];a+=c,n+i<s&&(a+=" ".repeat(r+2-c.length))}o.push(a)}return o}function*o(t,e,s=!1,n=null){const i=t.length,o=t[0].length,a=t.map((t=>t.map((t=>t.length)))),c=Array(o).fill(0);for(let t=0;t<i;t++)for(let e=0;e<o;e++)c[e]=Math.max(c[e],a[t][e]);function u(t){let e="╭├╰"[t];for(let s=0;s<o;s++)e+="─".repeat(c[s]+2),e+=s<o-1?"┬┼┴"[t]:"╮┤╯"[t];return e}s||(yield u(0));for(let a=0;a<i;a++){const l=t[a];let h=s?"":"│ ";for(let t=0;t<o;t++){const e=n?.get(t)||null;h+=e?e+l[t]+r.ansi.styleReset:l[t],h+=" ".repeat(c[t]-l[t].length),h+=s?"  ":" │ "}if(yield h,a===e-1)if(s){let t="";for(let e=0;e<o;e++)t+="─".repeat(c[e])+"  ";yield t}else a!==i-1&&(yield u(1))}s||(yield u(2))}},"./src/version.ts":function(t,e,s){s.r(e),s.d(e,{COCKLE_VERSION:function(){return r}});const r="0.0.12"},"./src/wasm_loader.ts":function(t,e,s){s.r(e),s.d(e,{WasmLoader:function(){return r}});class r{wasmBaseUrl;constructor(t){this.wasmBaseUrl=t}getModule(t){let e=this._cache.get(t);if(void 0===e){const s=this.wasmBaseUrl+t+".js";console.log("Importing JS/WASM from "+s),importScripts(s),e=self.Module,this._cache.set(t,e)}return e}_cache=new Map}},"./node_modules/comlink/dist/esm/comlink.mjs":function(t,e,s){s.r(e),s.d(e,{createEndpoint:function(){return n},expose:function(){return h},finalizer:function(){return o},proxy:function(){return S},proxyMarker:function(){return r},releaseProxy:function(){return i},transfer:function(){return w},transferHandlers:function(){return l},windowEndpoint:function(){return O},wrap:function(){return f}});const r=Symbol("Comlink.proxy"),n=Symbol("Comlink.endpoint"),i=Symbol("Comlink.releaseProxy"),o=Symbol("Comlink.finalizer"),a=Symbol("Comlink.thrown"),c=t=>"object"==typeof t&&null!==t||"function"==typeof t,u={canHandle:t=>c(t)&&t[r],serialize(t){const{port1:e,port2:s}=new MessageChannel;return h(t,e),[s,[s]]},deserialize:t=>(t.start(),f(t))},l=new Map([["proxy",u],["throw",{canHandle:t=>c(t)&&a in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function h(t,e=globalThis,s=["*"]){e.addEventListener("message",(function r(n){if(!n||!n.data)return;if(!function(t,e){for(const s of t){if(e===s||"*"===s)return!0;if(s instanceof RegExp&&s.test(e))return!0}return!1}(s,n.origin))return void console.warn(`Invalid origin '${n.origin}' for comlink proxy`);const{id:i,type:c,path:u}=Object.assign({path:[]},n.data),l=(n.data.argumentList||[]).map(x);let f;try{const e=u.slice(0,-1).reduce(((t,e)=>t[e]),t),s=u.reduce(((t,e)=>t[e]),t);switch(c){case"GET":f=s;break;case"SET":e[u.slice(-1)[0]]=x(n.data.value),f=!0;break;case"APPLY":f=s.apply(e,l);break;case"CONSTRUCT":f=S(new s(...l));break;case"ENDPOINT":{const{port1:e,port2:s}=new MessageChannel;h(t,s),f=w(e,[e])}break;case"RELEASE":f=void 0;break;default:return}}catch(t){f={value:t,[a]:0}}Promise.resolve(f).catch((t=>({value:t,[a]:0}))).then((s=>{const[n,a]=b(s);e.postMessage(Object.assign(Object.assign({},n),{id:i}),a),"RELEASE"===c&&(e.removeEventListener("message",r),d(e),o in t&&"function"==typeof t[o]&&t[o]())})).catch((t=>{const[s,r]=b({value:new TypeError("Unserializable return value"),[a]:0});e.postMessage(Object.assign(Object.assign({},s),{id:i}),r)}))})),e.start&&e.start()}function d(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function f(t,e){return C(t,[],e)}function m(t){if(t)throw new Error("Proxy has been released and is not useable")}function _(t){return v(t,{type:"RELEASE"}).then((()=>{d(t)}))}const p=new WeakMap,g="FinalizationRegistry"in globalThis&&new FinalizationRegistry((t=>{const e=(p.get(t)||0)-1;p.set(t,e),0===e&&_(t)}));function C(t,e=[],s=function(){}){let r=!1;const o=new Proxy(s,{get(s,n){if(m(r),n===i)return()=>{!function(t){g&&g.unregister(t)}(o),_(t),r=!0};if("then"===n){if(0===e.length)return{then:()=>o};const s=v(t,{type:"GET",path:e.map((t=>t.toString()))}).then(x);return s.then.bind(s)}return C(t,[...e,n])},set(s,n,i){m(r);const[o,a]=b(i);return v(t,{type:"SET",path:[...e,n].map((t=>t.toString())),value:o},a).then(x)},apply(s,i,o){m(r);const a=e[e.length-1];if(a===n)return v(t,{type:"ENDPOINT"}).then(x);if("bind"===a)return C(t,e.slice(0,-1));const[c,u]=y(o);return v(t,{type:"APPLY",path:e.map((t=>t.toString())),argumentList:c},u).then(x)},construct(s,n){m(r);const[i,o]=y(n);return v(t,{type:"CONSTRUCT",path:e.map((t=>t.toString())),argumentList:i},o).then(x)}});return function(t,e){const s=(p.get(e)||0)+1;p.set(e,s),g&&g.register(t,e,t)}(o,t),o}function y(t){const e=t.map(b);return[e.map((t=>t[0])),(s=e.map((t=>t[1])),Array.prototype.concat.apply([],s))];var s}const E=new WeakMap;function w(t,e){return E.set(t,e),t}function S(t){return Object.assign(t,{[r]:!0})}function O(t,e=globalThis,s="*"){return{postMessage:(e,r)=>t.postMessage(e,s,r),addEventListener:e.addEventListener.bind(e),removeEventListener:e.removeEventListener.bind(e)}}function b(t){for(const[e,s]of l)if(s.canHandle(t)){const[r,n]=s.serialize(t);return[{type:"HANDLER",name:e,value:r},n]}return[{type:"RAW",value:t},E.get(t)||[]]}function x(t){switch(t.type){case"HANDLER":return l.get(t.name).deserialize(t.value);case"RAW":return t.value}}function v(t,e,s){return new Promise((r=>{const n=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function e(s){s.data&&s.data.id&&s.data.id===n&&(t.removeEventListener("message",e),r(s.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:n},e),s)}))}}},e={};function s(r){var n=e[r];if(void 0!==n)return n.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,s),i.exports}s.d=function(t,e){for(var r in e)s.o(e,r)&&!s.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};s.r(r),s.d(r,{ShellWorker:function(){return a}});var n=s("./node_modules/comlink/dist/esm/comlink.mjs"),i=s("./src/buffered_io.ts"),o=s("./src/shell_impl.ts");class a{async initialize(t,e,s){this._bufferedIO=new i.WorkerBufferedIO(t.sharedArrayBuffer),this._enableBufferedStdinCallback=e,this._terminateCallback=s;const{color:r,mountpoint:n,wasmBaseUrl:a,driveFsBaseUrl:c,initialDirectories:u,initialFiles:l}=t;this._shellImpl=new o.ShellImpl({color:r,mountpoint:n,wasmBaseUrl:a,driveFsBaseUrl:c,initialDirectories:u,initialFiles:l,enableBufferedStdinCallback:this.enableBufferedStdin.bind(this),terminateCallback:this._terminateCallback.bind(this),stdinCallback:this._bufferedIO.read.bind(this._bufferedIO),bufferedIO:this._bufferedIO}),await this._shellImpl.initialize()}async enableBufferedStdin(t){this._bufferedIO&&(t?await this._bufferedIO.enable():await this._bufferedIO.disable()),this._enableBufferedStdinCallback&&this._enableBufferedStdinCallback(t)}async input(t){this._shellImpl&&await this._shellImpl.input(t)}async setSize(t,e){this._shellImpl&&await this._shellImpl.setSize(t,e)}async start(){this._shellImpl&&await this._shellImpl.start()}_shellImpl;_bufferedIO;_enableBufferedStdinCallback;_terminateCallback}const c=new a;return(0,n.expose)(c),r})()}.call(e,s,e,t),void 0===r||(t.exports=r)}},e={};function s(r){var n=e[r];if(void 0!==n)return n.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,s),i.exports}s.m=t,s.c=e,s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{s.S={};var t={},e={};s.I=(r,n)=>{n||(n=[]);var i=e[r];if(i||(i=e[r]={}),!(n.indexOf(i)>=0)){if(n.push(i),t[r])return t[r];s.o(s.S,r)||(s.S[r]={}),s.S[r];var o=[];return t[r]=o.length?Promise.all(o).then((()=>t[r]=1)):1}}})(),s(817)})();